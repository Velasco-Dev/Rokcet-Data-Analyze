{% extends 'analyze/base.html' %}

{% block title %}An√°lisis - {{ file.name }}{% endblock %}

{% block content %}
<div class="container-header">
    <div class="container">
        <h1>üìä An√°lisis: {{ file.name }}</h1>
        <p class="text-white">{{ file.filename }}</p>
    </div>
</div>

<div class="container-fluid">
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb bg-white p-3 rounded shadow-sm">
            <li class="breadcrumb-item"><a href="{% url 'analyze:dashboard' %}">Dashboard</a></li>
            <li class="breadcrumb-item active">{{ file.name }}</li>
        </ol>
    </nav>

    <!-- Tabs para seleccionar tipo de an√°lisis -->
    <ul class="nav nav-tabs mb-4" id="analysisTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link {% if analysis_type == 'basic' %}active{% endif %}" 
                    onclick="window.location.href='?analysis=basic'" type="button">
                üìà An√°lisis B√°sico
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link {% if analysis_type == 'complete' %}active{% endif %}" 
                    onclick="window.location.href='?analysis=complete'" type="button">
                üöÄ An√°lisis Completo (Todos los Requerimientos)
            </button>
        </li>
    </ul>

    <!-- Selector de fecha para datos meteorol√≥gicos (solo visible en an√°lisis completo) -->
    {% if analysis_type == 'complete' %}
    <div class="card mb-4">
        <div class="card-header bg-success text-white">
            <h5 class="card-title mb-0">üñºÔ∏è Presentaci√≥n</h5>
        </div>
        <div class="card-body">
            <iframe src="https://docs.google.com/presentation/d/e/2PACX-1vRlvxZffW903eaZMQJAuJfNu5eAe8cU8h2I4OLGrvKY6ZR2Fmg8esbyKHfZTGQdaA/pubembed?start=false&loop=true&delayms=3000" frameborder="0" width="960" height="629" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>
        </div>
    </div>
    {% endif %}

    {% if analysis_type == 'basic' %}
    <!-- AN√ÅLISIS B√ÅSICO -->
    <!-- Estad√≠sticas -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">‚ÑπÔ∏è Informaci√≥n General</h5>
                </div>
                <div class="card-body">
                    <p><strong>Total de registros:</strong> {{ stats.total_records }}</p>
                    <p><strong>Duraci√≥n:</strong> {{ stats.duration_seconds|floatformat:2 }} segundos</p>
                    <p><strong>Inicio:</strong> {{ stats.time_range.start }}</p>
                    <p><strong>Fin:</strong> {{ stats.time_range.end }}</p>
                </div>
            </div>
        </div>
        
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5 class="card-title mb-0">üìà Estad√≠sticas de Variables</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <h6 class="text-danger">üå°Ô∏è Temperatura </h6>
                            <small>
                                <strong>M√°x:</strong> {{ stats.temperature_stats.max|floatformat:2 }} ¬∞C<br>
                                <strong>M√≠n:</strong> {{ stats.temperature_stats.min|floatformat:2 }} ¬∞C<br>
                                <strong>Media:</strong> {{ stats.temperature_stats.mean|floatformat:2 }} ¬∞C
                            </small>
                        </div>
                        <div class="col-md-4">
                            <h6 class="text-warning">üí® Presi√≥n</h6>
                            <small>
                                <strong>M√°x:</strong> {{ stats.pressure_stats.max|floatformat:2 }} kPa<br>
                                <strong>M√≠n:</strong> {{ stats.pressure_stats.min|floatformat:2 }} kPa<br>
                                <strong>Media:</strong> {{ stats.pressure_stats.mean|floatformat:2 }} kPa
                            </small>
                        </div>
                        <div class="col-md-4">
                            <h6 class="text-success">üìç Altura</h6>
                            <small>
                                <strong>M√°x:</strong> {{ stats.altitude_stats.max|floatformat:2 }} m<br>
                                <strong>M√≠n:</strong> {{ stats.altitude_stats.min|floatformat:2 }} m<br>
                                <strong>Media:</strong> {{ stats.altitude_stats.mean|floatformat:2 }} m
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Gr√°fica combinada -->
    <div class="card mb-4">
        <div class="card-header bg-success text-white">
            <h5 class="card-title mb-0">üîó Vista Combinada</h5>
        </div>
        <div class="card-body">
            {{ combined_plot|safe }}
        </div>
    </div>

    <!-- Gr√°ficas individuales interactivas -->
    <div class="card mb-4">
        <div class="card-header bg-warning text-dark">
            <h5 class="card-title mb-0">üìä Gr√°ficas Individuales Interactivas</h5>
        </div>
        <div class="card-body">
            {{ interactive_plots.temperature|safe }}
            {{ interactive_plots.pressure|safe }}
            {{ interactive_plots.altitude|safe }}
        </div>
    </div>

    <!-- Gr√°fica matplotlib (est√°tica) -->
    <div class="card mb-4">
        <div class="card-header bg-secondary text-white">
            <h5 class="card-title mb-0">üé® Vista R√°pida (Matplotlib)</h5>
        </div>
        <div class="card-body text-center">
            <img src="data:image/png;base64,{{ matplotlib_plot }}" 
                 alt="Gr√°ficas de an√°lisis" class="img-fluid rounded">
        </div>
    </div>

    {% elif analysis_type == 'complete' %}
    <!-- AN√ÅLISIS COMPLETO DE TODOS LOS REQUERIMIENTOS -->
    
    <!-- REQUERIMIENTO 1: AN√ÅLISIS COMPARATIVO Y VALIDACI√ìN MULTI-SENSOR -->
    <div class="card mb-4 border-primary">
        <div class="card-header bg-primary text-white">
            <h3 class="card-title mb-0">üìã REQUERIMIENTO 1: An√°lisis Comparativo y Validaci√≥n Multi-Sensor</h3>
        </div>
        <div class="card-body">
            
            <!-- 1.1 An√°lisis de Vuelos Detectados -->
            <div class="mb-4">
                <h4 class="text-primary">1.1 üìè An√°lisis de Vuelos Detectados</h4>
                
                <!-- Tabla de vuelos detectados -->
                <div class="card mb-3">
                        {% if advanced_analysis.validation.error_stats.vuelos_detectados %}
                        <div class="alert alert-success">
                            <h6>‚úÖ Vuelos Detectados: {{ advanced_analysis.validation.error_stats.vuelos_detectados|length }}</h6>
                            <div class="table-responsive">
                                <table class="table table-sm table-bordered mt-2">
                                    <thead class="thead-light">
                                        <tr>
                                            <th>Vuelo</th>
                                            <th>Altura Inicial (m)</th>
                                            <th>Altura Pico (m)</th>
                                            <th>Altura Ganada (m)</th>
                                            <th>Duraci√≥n Total (s)</th>
                                            <th>Ascenso (s)</th>
                                            <th>Descenso (s)</th>
                                            <th>Vel. Prom. (m/s)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for vuelo in advanced_analysis.validation.error_stats.vuelos_detectados %}
                                        <tr>
                                            <td><strong>{{ vuelo.numero }}</strong></td>
                                            <td>{{ vuelo.altura_inicio|floatformat:2 }}</td>
                                            <td>{{ vuelo.altura_pico|floatformat:2 }}</td>
                                            <td><strong class="text-primary">{{ vuelo.altura_ganada|floatformat:2 }}</strong></td>
                                            <td><strong class="text-success">{{ vuelo.duracion_total|floatformat:2 }}</strong></td>
                                            <td>{{ vuelo.duracion_ascenso|floatformat:2 }}</td>
                                            <td>{{ vuelo.duracion_descenso|floatformat:2 }}</td>
                                            <td>{{ vuelo.velocidad_promedio|floatformat:2 }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% if advanced_analysis.validation.error_stats.tiempo_promedio_vuelos %}
                            <div class="mt-2">
                                <p class="mb-1"><strong>üìä Promedios:</strong></p>
                                <ul class="mb-0">
                                    <li><strong>Duraci√≥n:</strong> {{ advanced_analysis.validation.error_stats.tiempo_promedio_vuelos|floatformat:2 }} segundos</li>
                                    <li><strong>Altura Ganada:</strong> {{ advanced_analysis.validation.error_stats.altura_promedio_ganada|floatformat:2 }} metros</li>
                                </ul>
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}
                        
                        <small class="text-muted mt-2 d-block">
                            üí° <strong>Detecci√≥n Autom√°tica:</strong> El sistema detecta todos los vuelos mediante an√°lisis de picos y valles. 
                            La altura inicial es la altura promedio del reposo antes del primer vuelo.
                        </small>
                    </div>
                </div>
                
                <!-- Gr√°fica -->
                {{ advanced_analysis.validation.plot|safe }}
            </div>

            <!-- 1.2 Dashboard Ambiental -->
            <div class="mb-4">
                <h4 class="text-primary">1.2 üåê Dashboard Ambiental (Comparaci√≥n con Datos Externos)</h4>
                
                {% if advanced_analysis.weather_comparison.error %}
                    <div class="alert alert-warning">
                        <h5>‚ö†Ô∏è {{ advanced_analysis.weather_comparison.message }}</h5>
                        {% if advanced_analysis.weather_comparison.instructions %}
                            <p><strong>Instrucciones para activar:</strong></p>
                            <ol>
                                {% for instruction in advanced_analysis.weather_comparison.instructions %}
                                <li>{{ instruction }}</li>
                                {% endfor %}
                            </ol>
                        {% endif %}
                    </div>
                {% else %}
                    <!-- Informaci√≥n de la fecha consultada -->
                    <div class="alert alert-info">
                        <strong>üìÖ Fecha consultada:</strong> {{ advanced_analysis.weather_comparison.query_date }}
                        {% if advanced_analysis.weather_comparison.warning %}
                            <br><small class="text-warning">‚ö†Ô∏è {{ advanced_analysis.weather_comparison.warning }}</small>
                        {% endif %}
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card bg-light">
                                <div class="card-header bg-info text-white">
                                    <h5>üì° Datos del Sensor (Promedio)</h5>
                                </div>
                                <div class="card-body">
                                    <p><strong>Temperatura:</strong> {{ advanced_analysis.weather_comparison.sensor_data.temperatura_sensor|floatformat:2 }} ¬∞C</p>
                                    <p><strong>Presi√≥n:</strong> {{ advanced_analysis.weather_comparison.sensor_data.presion_sensor|floatformat:2 }} kPa</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card bg-light">
                                <div class="card-header bg-warning text-dark">
                                    <h5>üå§Ô∏è Datos Meteorol√≥gicos ({{ advanced_analysis.weather_comparison.external_data.ubicacion }})</h5>
                                </div>
                                <div class="card-body">
                                    <p><strong>Temperatura:</strong> {{ advanced_analysis.weather_comparison.external_data.temperatura_externa|floatformat:2 }} ¬∞C</p>
                                    <p><strong>Presi√≥n:</strong> {{ advanced_analysis.weather_comparison.external_data.presion_externa|floatformat:2 }} kPa</p>
                                    <p><strong>Humedad:</strong> {{ advanced_analysis.weather_comparison.external_data.humedad }}%</p>
                                    <p><strong>Condiciones:</strong> {{ advanced_analysis.weather_comparison.external_data.descripcion }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-info mt-3">
                        <h5>üìä An√°lisis de Diferencias:</h5>
                        <p><strong>Diferencia de Temperatura:</strong> {{ advanced_analysis.weather_comparison.comparisons.diff_temperatura|floatformat:2 }} ¬∞C 
                           ({{ advanced_analysis.weather_comparison.comparisons.diff_temperatura_pct|floatformat:1 }}%)</p>
                        <p><strong>Diferencia de Presi√≥n:</strong> {{ advanced_analysis.weather_comparison.comparisons.diff_presion|floatformat:2 }} kPa 
                           ({{ advanced_analysis.weather_comparison.comparisons.diff_presion_pct|floatformat:1 }}%)</p>
                    </div>
                    
                    <div class="alert alert-success">
                        <h5>üí° Interpretaci√≥n:</h5>
                        <ul>
                            {% for interp in advanced_analysis.weather_comparison.interpretation %}
                            <li>{{ interp }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    
                    {{ advanced_analysis.weather_comparison.plot_temperature|safe }}
                    {{ advanced_analysis.weather_comparison.plot_pressure|safe }}
                {% endif %}
            </div>

            <!-- 1.3 Curva Altitud vs Presi√≥n -->
            <div class="mb-4">
                <h4 class="text-primary">1.3 üìä Curva Altitud vs Presi√≥n vs Ecuaci√≥n Barom√©trica</h4>
                <div class="alert alert-secondary">
                    Esta gr√°fica compara los datos reales del sensor con la ecuaci√≥n barom√©trica te√≥rica para verificar la consistencia del sensor.
                </div>
                {{ advanced_analysis.altitude_pressure|safe }}
            </div>

        </div>
    </div>

    <!-- REQUERIMIENTO 2: DIAGN√ìSTICO DE EVENTOS Y ATM√ìSFERA -->
    <div class="card mb-4 border-success">
        <div class="card-header bg-success text-white">
            <h3 class="card-title mb-0">üìã REQUERIMIENTO 2: Diagn√≥stico de Eventos y Atm√≥sfera</h3>
        </div>
        <div class="card-body">
            
            <!-- 2.1 Fases del Vuelo -->
            <div class="mb-4">
                <h4 class="text-success">2.1 üöÄ Fases del Vuelo (Ascenso, Apogeo, Descenso)</h4>
                
                {% if advanced_analysis.flight_phases.stats.warning %}
                <div class="alert alert-warning">
                    <h5>‚ö†Ô∏è Advertencia:</h5>
                    <p>{{ advanced_analysis.flight_phases.stats.warning }}</p>
                    <p><strong>Variaci√≥n de Altura Detectada:</strong> {{ advanced_analysis.flight_phases.stats.variacion_altura|floatformat:2 }} m</p>
                    <p><strong>Rango:</strong> {{ advanced_analysis.flight_phases.stats.altura_minima|floatformat:2 }} m - {{ advanced_analysis.flight_phases.stats.altura_maxima|floatformat:2 }} m</p>
                </div>
                {% endif %}
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="alert {% if advanced_analysis.flight_phases.stats.vuelo_detectado %}alert-success{% else %}alert-secondary{% endif %}">
                            <strong>üéØ Altura M√°xima:</strong> {{ advanced_analysis.flight_phases.stats.apogeo_altura|floatformat:2 }} m<br>
                            <strong>‚è±Ô∏è Tiempo al Apogeo:</strong> {{ advanced_analysis.flight_phases.stats.apogeo_tiempo }}<br>
                            <strong>‚è´ Duraci√≥n Ascenso:</strong> {{ advanced_analysis.flight_phases.stats.duracion_ascenso|floatformat:2 }} s
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="alert {% if advanced_analysis.flight_phases.stats.vuelo_detectado %}alert-warning{% else %}alert-secondary{% endif %}">
                            <strong>‚è¨ Duraci√≥n Descenso:</strong> {{ advanced_analysis.flight_phases.stats.duracion_descenso|floatformat:2 }} s<br>
                            <strong>‚ö° Velocidad M√°x Ascenso:</strong> {{ advanced_analysis.flight_phases.stats.velocidad_max_ascenso|floatformat:2 }} m/s<br>
                            <strong>ü™Ç Velocidad M√°x Descenso:</strong> {{ advanced_analysis.flight_phases.stats.velocidad_max_descenso|floatformat:2 }} m/s
                        </div>
                    </div>
                </div>
                {{ advanced_analysis.flight_phases.plot|safe }}
            </div>

            <!-- 2.2 An√°lisis Paraca√≠das -->
            <div class="mb-4">
                <h4 class="text-success">2.2 ü™Ç An√°lisis de Despliegue del Paraca√≠das</h4>
                
                {% if advanced_analysis.parachute.warning %}
                <div class="alert alert-warning">
                    <strong>‚ö†Ô∏è Advertencia:</strong> {{ advanced_analysis.parachute.warning }}
                </div>
                {% endif %}
                
                <div class="alert {% if advanced_analysis.parachute.parachute_detected %}alert-success{% else %}alert-{% if advanced_analysis.parachute.vuelo_detectado %}warning{% else %}secondary{% endif %}{% endif %}">
                    <strong>Estado:</strong> 
                    {% if advanced_analysis.parachute.parachute_detected %}
                        ‚úÖ Paraca√≠das detectado<br>
                        <strong>Tiempo de despliegue:</strong> {{ advanced_analysis.parachute.parachute_time }}<br>
                        <strong>Altura de despliegue:</strong> {{ advanced_analysis.parachute.parachute_height|floatformat:2 }} m
                    {% else %}
                        {% if advanced_analysis.parachute.vuelo_detectado %}
                            ‚ö†Ô∏è No se detect√≥ despliegue claro del paraca√≠das en los datos
                        {% else %}
                            ‚ÑπÔ∏è No aplicable (sensor en reposo, sin vuelo real)
                        {% endif %}
                    {% endif %}
                </div>
                {{ advanced_analysis.parachute.plot|safe }}
            </div>

            <!-- 2.3 Densidad del Aire -->
            <div class="mb-4">
                <h4 class="text-success">2.3 üí® Densidad del Aire Durante el Vuelo</h4>
                
                {% if advanced_analysis.air_density.warning %}
                <div class="alert alert-info">
                    <strong>‚ÑπÔ∏è Informaci√≥n Importante:</strong>
                    <p>{{ advanced_analysis.air_density.warning }}</p>
                </div>
                {% endif %}
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="alert alert-info">
                            <strong>Densidad Promedio:</strong> {{ advanced_analysis.air_density.stats.densidad_promedio|floatformat:4 }} kg/m¬≥<br>
                            <strong>Densidad M√°xima:</strong> {{ advanced_analysis.air_density.stats.densidad_max|floatformat:4 }} kg/m¬≥<br>
                            <strong>Densidad M√≠nima:</strong> {{ advanced_analysis.air_density.stats.densidad_min|floatformat:4 }} kg/m¬≥
                            {% if not advanced_analysis.air_density.vuelo_detectado %}
                                <br><small class="text-muted">(Condiciones atmosf√©ricas en reposo)</small>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="alert alert-secondary">
                            <strong>üìä Impacto en el Rendimiento:</strong><br>
                            <strong>Densidad en Ascenso:</strong> {{ advanced_analysis.air_density.impact_analysis.densidad_promedio_ascenso|floatformat:4 }} kg/m¬≥<br>
                            <strong>Densidad en Descenso:</strong> {{ advanced_analysis.air_density.impact_analysis.densidad_promedio_descenso|floatformat:4 }} kg/m¬≥<br>
                            <strong>Diferencia:</strong> {{ advanced_analysis.air_density.impact_analysis.diferencia_porcentual|floatformat:2 }}%<br>
                            <em>{{ advanced_analysis.air_density.impact_analysis.interpretacion }}</em>
                        </div>
                    </div>
                </div>
                {{ advanced_analysis.air_density.plot|safe }}
            </div>

            <!-- 2.4 Anomal√≠as -->
            <div class="mb-4">
                <h4 class="text-success">2.4 ‚ö†Ô∏è Detecci√≥n de Anomal√≠as</h4>
                
                {% if advanced_analysis.anomalies.warning %}
                <div class="alert alert-info">
                    <strong>‚ÑπÔ∏è Informaci√≥n Importante:</strong>
                    <p>{{ advanced_analysis.anomalies.warning }}</p>
                </div>
                {% endif %}
                
                <div class="alert alert-{% if advanced_analysis.anomalies.total_anomalies > 0 %}warning{% else %}success{% endif %}">
                    <strong>Total de Anomal√≠as Detectadas:</strong> {{ advanced_analysis.anomalies.total_anomalies }}
                    {% if not advanced_analysis.anomalies.vuelo_detectado %}
                        <br><small class="text-muted">(Principalmente ruido normal del sensor en reposo)</small>
                    {% endif %}
                </div>
                {% if advanced_analysis.anomalies.anomalies %}
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Timestamp</th>
                            <th>Valor</th>
                            <th>Altura</th>
                            <th>Causa Probable</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for anomaly in advanced_analysis.anomalies.anomalies %}
                        <tr>
                            <td><span class="badge bg-{% if advanced_analysis.anomalies.vuelo_detectado %}danger{% else %}secondary{% endif %}">{{ anomaly.tipo }}</span></td>
                            <td>{{ anomaly.timestamp }}</td>
                            <td>{{ anomaly.valor|floatformat:2 }}</td>
                            <td>{{ anomaly.altura|floatformat:2 }} m</td>
                            <td>{{ anomaly.causa_probable }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% endif %}
                
                <h5 class="mt-4">Gr√°fica de Temperatura:</h5>
                {{ advanced_analysis.anomalies.plot_temperature|safe }}
                
                <h5 class="mt-4">Gr√°fica de Presi√≥n:</h5>
                {{ advanced_analysis.anomalies.plot_pressure|safe }}
            </div>

        </div>
    </div>

    <!-- REQUERIMIENTO 3: OPTIMIZACI√ìN BASADA EN EVIDENCIA -->
    <div class="card mb-4 border-warning">
        <div class="card-header bg-warning text-dark">
            <h3 class="card-title mb-0">üìã REQUERIMIENTO 3: Optimizaci√≥n Basada en Evidencia</h3>
        </div>
        <div class="card-body">
            
            <!-- 3.1 F√≥rmula del √âxito -->
            <div class="mb-4">
                <h4 class="text-warning">3.1 üèÜ F√≥rmula del √âxito: Condiciones √ìptimas</h4>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="card bg-light">
                            <div class="card-header bg-success text-white">
                                <h5>üöÄ Condiciones de Lanzamiento</h5>
                            </div>
                            <div class="card-body">
                                <p><strong>Presi√≥n Inicial:</strong> {{ advanced_analysis.success_formula.launch_conditions.presion_inicial|floatformat:2 }} kPa</p>
                                <p><strong>Temperatura Inicial:</strong> {{ advanced_analysis.success_formula.launch_conditions.temperatura_inicial|floatformat:2 }} ¬∞C</p>
                                <p><strong>Altura Inicial:</strong> {{ advanced_analysis.success_formula.launch_conditions.altura_inicial|floatformat:2 }} m</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card bg-light">
                            <div class="card-header bg-warning text-dark">
                                <h5>üéØ Resultados en el Apogeo</h5>
                            </div>
                            <div class="card-body">
                                <p><strong>Altura M√°xima:</strong> {{ advanced_analysis.success_formula.apogee_conditions.altura_maxima|floatformat:2 }} m</p>
                                <p><strong>Tiempo hasta Apogeo:</strong> {{ advanced_analysis.success_formula.apogee_conditions.tiempo_al_apogeo|floatformat:2 }} s</p>
                                <p><strong>Temperatura en Apogeo:</strong> {{ advanced_analysis.success_formula.apogee_conditions.temperatura_apogeo|floatformat:2 }} ¬∞C</p>
                                <p><strong>Presi√≥n en Apogeo:</strong> {{ advanced_analysis.success_formula.apogee_conditions.presion_apogeo|floatformat:2 }} kPa</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="alert alert-success mt-3">
                    <h5>‚ú® Recomendaciones para Optimizaci√≥n:</h5>
                    <ul>
                        {% for rec in advanced_analysis.success_formula.recommendations %}
                        <li>{{ rec }}</li>
                        {% endfor %}
                    </ul>
                </div>

                {{ advanced_analysis.success_formula.plot|safe }}
            </div>

        </div>
    </div>

    {% endif %}

    <!-- Bot√≥n volver -->
    <div class="mb-4">
        <a href="{% url 'analyze:dashboard' %}" class="btn btn-primary btn-lg">
            ‚Üê Volver al Dashboard
        </a>
    </div>
</div>

{% endblock %}