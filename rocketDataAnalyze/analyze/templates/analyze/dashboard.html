{% extends 'analyze/base.html' %}

{% block title %}Dashboard - An√°lisis de Cohetes{% endblock %}

{% block content %}
<div class="container-header">
    <div class="container">
        <h1>An√°lisis de Datos del Cohete</h1>
        <p>Gestiona y analiza tus archivos de cohetes</p>
    </div>
</div>

<div class="container">
<!-- Mensajes de √©xito/error -->
    {% if messages %}
    <div class="alert-container">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="mb-4 d-flex justify-content-between align-items-center">
        <h2 class="mb-0">Mis Archivos</h2>
        <button class="btn btn-success btn-lg" data-bs-toggle="modal" data-bs-target="#uploadModal">
            <i class="bi bi-plus-circle"></i> Subir Nuevo Archivo
        </button>
    </div>

    <div class="row">
        {% for file in files %}
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">{{ file.name }}</h5>
                </div>
                <div class="card-body">
                    <p class="card-text">
                        <strong>Archivo:</strong> {{ file.filename }}<br>
                        <small class="text-muted">Subido: {{ file.uploaded_at|date:"d/m/Y H:i" }}</small>
                    </p>
                    <div class="btn-group w-100" role="group">
                        <a href="{% url 'analyze:file_analyze' file.id %}" 
                           class="btn btn-info btn-sm flex-grow-1">
                           üìä Analizar
                        </a>
                        <a href="{% url 'analyze:delete_file' file.id %}" 
                           class="btn btn-danger btn-sm flex-grow-1"
                           onclick="return confirm('¬øEliminar este archivo?')">
                           üóëÔ∏è Eliminar
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12">
            <div class="alert alert-info alert-dismissible fade show" role="alert">
                <strong>Sin archivos</strong> No hay archivos subidos. 
                <button type="button" class="btn btn-info btn-sm ms-2" data-bs-toggle="modal" data-bs-target="#uploadModal">
                    Sube el primer archivo
                </button>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Modal de Upload -->
<div class="modal fade" id="uploadModal" tabindex="-1" aria-labelledby="uploadModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="uploadModalLabel">üì§ Subir Archivo CSV del Cohete</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" enctype="multipart/form-data" action="{% url 'analyze:upload' %}">
                <div class="modal-body">
                    {% csrf_token %}
                    
                    <!-- Campo Nombre -->
                    <div class="mb-3">
                        <label for="{{ form.name.id_for_label }}" class="form-label fw-bold">Nombre del an√°lisis:</label>
                        {{ form.name }}
                        {% if form.name.errors %}
                            <div class="alert alert-danger mt-2 mb-0">
                                {% for error in form.name.errors %}
                                    <small>{{ error }}</small>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Campo Archivo -->
                    <div class="mb-3">
                        <label for="{{ form.file.id_for_label }}" class="form-label fw-bold">Selecciona un archivo CSV:</label>
                        {{ form.file }}
                        <small class="text-muted d-block mt-2">
                            Formatos aceptados: CSV | Tama√±o m√°ximo: 50MB
                        </small>
                        {% if form.file.errors %}
                            <div class="alert alert-danger mt-2 mb-0">
                                {% for error in form.file.errors %}
                                    <small>{{ error }}</small>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Campo Descripci√≥n -->
                    <div class="mb-3">
                        <label for="{{ form.description.id_for_label }}" class="form-label fw-bold">Descripci√≥n (opcional):</label>
                        {{ form.description }}
                        {% if form.description.errors %}
                            <div class="alert alert-danger mt-2 mb-0">
                                {% for error in form.description.errors %}
                                    <small>{{ error }}</small>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-success">
                        <i class="bi bi-upload"></i> Subir Archivo
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

{% endblock %}